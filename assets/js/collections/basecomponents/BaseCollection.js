App.Collections.BaseCollection = Backbone.Collection.extend({

  // The XMLHttpRequest object generated by the jquery AJAX request
  // from Backbone.sync. It will be stored during the sync process so it's
  // possible to abort the request anytime.
  _jqXHR: null,

  // Functions (Core)
  //-----------------

  // Join this collection with another collection. The original contents of
  // the 'field' parameter need to be the id of the table being joined.
  join: function(field, collection) {
    this.each(function(model) {
      var foreignModel = collection.find(function(model2) {
        return model2.get(model2.idAttribute) === model.get(field);
      });

      // Only replace the value if the existing value is not a model already.
      if (foreignModel) {
        model.set(field, foreignModel.attributes);
      } else if (typeof (model.get(field)) !== 'object' ||
          model.get(field) === null) {
        model.set(field, undefined);
      }
    });
  }

})
